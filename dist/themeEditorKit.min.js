!function(){"use strict";const e={rem:{min:0,max:10,step:.05,base:16},px:{min:0,max:100,step:1},em:{min:0,max:5,step:.25},"%":{min:0,max:100,step:1},vh:{min:0,max:100,step:1},vw:{min:0,max:100,step:1},pt:{min:0,max:100,step:1}},t=e=>{if(e.startsWith("#")&&4===e.length){const[,t,n,i]=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);e=`#${t}${t}${n}${n}${i}${i}`}return e};function n(t,n,i){if(n===i)return t;const s=document.createElement("div");document.body.appendChild(s);const o=e.rem?e.rem.base:16;"rem"===n?s.style.fontSize=`${t}rem`:"em"===n?s.style.fontSize=`${t}em`:"px"===n?s.style.fontSize=`${t}px`:"%"===n?s.style.fontSize=`${t}%`:"vh"===n?s.style.height=`${t}vh`:"vw"===n?s.style.width=`${t}vw`:"pt"===n&&(s.style.fontSize=`${t}pt`);const a=window.getComputedStyle(s).fontSize||window.getComputedStyle(s).height||window.getComputedStyle(s).width;document.body.removeChild(s);const r=parseFloat(a);if("px"===i)return r;if("rem"===i)return r/o;if("em"===i){const e=document.createElement("div");e.style.fontSize="1em",document.body.appendChild(e);const t=window.getComputedStyle(e).fontSize;document.body.removeChild(e);return r/parseFloat(t)}return"vh"===i?r/(window.innerHeight/100):"vw"===i?r/(window.innerWidth/100):"pt"===i?1.333*r:t}function i(e){if("string"!=typeof e)return"";if(e.match(/#[0-9a-fA-F]{3,6}/))return"";const t=e.match(/[a-zA-Z%]+$/);return t?t[0]:""}function s(e){if(/^#([0-9a-fA-F]{3}){1,2}$/.test(e))return!0;if(/^rgb(a)?\(\s*(\d{1,3}\s*,\s*){2}\d{1,3}\s*(,\s*(0?\.\d+|1(\.0+)?))?\s*\)$/.test(e)){const[t,n,i,s,o,a]=e.match(/rgb(a)?\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})(?:,\s*(0?\.\d+|1(\.0+)?))?\s*\)/);if(void 0===n||void 0===a||parseFloat(a)>=0&&parseFloat(a)<=1)return!0}return!!["black","white","red","green","blue","yellow","cyan","magenta","gray","grey","silver","maroon","olive","purple","teal","navy","aqua","fuchsia","lime","orange"].includes(e.toLowerCase())}const o="[data-sync]",a='[name^="selector("]';function r(e){const t=e.dataset.sync;return t?[...document.querySelectorAll(`[data-sync="${t}"]`)]:[e]}function l(e,t=null){const s=r(e);let{unit:o,min:a,minAsNumber:l,minUnit:d,max:m,maxAsNumber:c,maxUnit:h,step:u,stepAsNumber:p,stepUnit:f,feedbackSelector:v,feedbackElements:y=[],...E}=s.reduce(((e,t)=>{const n=t.dataset,s=isNaN(parseFloat(t.value))?e.valueAsNumber:parseFloat(t.value),o=n.unit||i(t.value)||e.unit,a=void 0===n.min||isNaN(parseFloat(n.min))?isNaN(parseFloat(t.min))?e.minAsNumber:parseFloat(t.min):parseFloat(n.min),r=n.minUnit||i(n.min)||e.minUnit,l=void 0===n.max||isNaN(parseFloat(n.max))?isNaN(parseFloat(t.max))?e.maxAsNumber:parseFloat(t.max):parseFloat(n.max),d=n.maxUnit||i(n.max)||e.maxUnit,m=void 0===n.step||isNaN(parseFloat(n.step))?isNaN(parseFloat(t.step))?e.stepAsNumber:parseFloat(t.step):parseFloat(n.step),c=n.stepUnit||i(n.step)||e.stepUnit,h=void 0!==typeof a?r?`${a}${r}`:a:e.min,u=void 0!==typeof l?d?`${l}${d}`:l:e.max,p=void 0!==typeof m?c?`${m}${c}`:m:e.step;return void 0!==n.feedback?n.feedback:n.type,void 0!==n.feedback&&(n.feedback?e.feedbackSelector=n.feedback:""===n.feedback&&(e.feedbackElements=e.feedbackElements?[...e.feedbackElements,t]:[t])),{...n,...e,min:h,max:u,step:p,unit:o,valueAsNumber:s,minAsNumber:a,minUnit:r,maxAsNumber:l,maxUnit:d,stepAsNumber:m,stepUnit:c}}),{});return(t=t||o)&&(a=n(l,d,t),d=t,m=n(c,h,t),h=t,u=n(p,f,t)),v&&(y=[...y,...document.querySelectorAll(v)]),{...E,feedbackSelector:v,feedbackElements:y,min:a,minUnit:d,max:m,maxUnit:h,step:u,unit:o}}function d(e){[...e.target.querySelectorAll(a)].forEach((e=>{e.hasAttribute("name")&&c(e)}))}function m(e){c(e.target)}function c(e){const o=r(e),a=o.filter((t=>t!==e)),d=o.find((e=>e.hasAttribute("name")))||e,m="select"===e.tagName.toLowerCase()&&[...e.options].some((e=>e.value.match(/(rem|px|em|%|vh|vw|pt)/))),c="string"!=typeof d.value||isNaN(parseFloat(d.value))?d.value:parseFloat(d.value),h=i(d.value);let u=m?e.value:i(e.value)||h||"",p=e.valueAsNumber||!isNaN(parseFloat(e.value))?parseFloat(e.value):NaN;m&&(p=n(c,h,u));const{min:f,max:v,step:y,...E}=l(e,u);a.forEach((n=>{switch("input"===n.tagName.toLowerCase()?n.type:n.tagName.toLowerCase()){case"range":case"number":n.min=f,n.max=v,n.step=y,n.value=String(p);break;case"text":case"hidden":n.value=u?`${isNaN(p)?"":p}${u}`:e.value;break;case"color":n.value=s(e.value)?t(e.value):"";break;case"select":[...n.options].forEach((e=>{e.selected=e.value===u})),n.setAttribute("data-unit",u)}})),o.forEach((e=>{!function(e,t,n=null){if(!Reflect.has(e,"validity"))return!0;e.setCustomValidity("");const{min:i,max:o,minUnit:a,maxUnit:d,feedbackElements:m=[]}=n||l(e),c=e.value;let h=!0,u="",p=e.dataset.type;if(p||(p="input"===e.tagName.toLowerCase()?e.type:e.tagName.toLowerCase()),e.required&&!e.value&&(h=!1,u="This field is required"),h){const t=e.value;"color"===p&&(h=s(t),u="Please select a valid color"),"number"===p&&(h=function(e){return!!e&&/^(\d+(\.\d+)?)(px|em|rem|%|vh|vw|pt|cm|mm|in|pc)?$/.test(e)}(t),u="Please enter a valid CSS value")}h&&(t=void 0!==t?t:Reflect.has(e,"valueAsNumber")?e.valueAsNumber:isNaN(parseFloat(c))?void 0:parseFloat(c),isNaN(t)||void 0===t||(void 0!==i&&t<i&&(h=!1,u=`Value must be greater than or equal to ${i}${a||""}`),void 0!==o&&t>o&&(h=!1,u=`Value must be less than or equal to ${o}${d||""}`)));const f=r(e);m&&m.forEach((e=>{e.innerHTML=u})),f.forEach((e=>{Reflect.has(e,"validity")?h?(e.classList.remove("is-invalid"),e.setCustomValidity("")):(e.classList.add("is-invalid"),e.setCustomValidity("Invalid value")):e.dataset.type}))}(e,p,{min:f,max:v,...E})}))}class h{constructor(e,t={}){if(!(e instanceof HTMLElement))throw new TypeError("inputElement must be an HTML element");this.inputElement=e,this.options={...t,...e.dataset},this.dropdownClass=this.options.dropdownClass||"menu",this.dropdownItemClass=this.options.dropdownItemClass||"menu-item",this.dropdownItemActiveClass=this.options.dropdownItemActiveClass||"active",this.data=t.data||[],this.onSelect=t.onSelect||(()=>{}),this.selectedOption="",this.userInteraction=!1,this.populateDropdown=this.populateDropdown.bind(this),this.selectOption=this.selectOption.bind(this),this.highlightSelectedOption=this.highlightSelectedOption.bind(this),this.handleInput=this.handleInput.bind(this),this.handleChange=this.handleChange.bind(this),this.handleProgrammaticInput=this.handleProgrammaticInput.bind(this),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),this.initialize()}initialize(){if(this.dropdownTemplateId=this.options.dropdownTemplateId||this.inputElement.dataset.suggestDropdownTemplate,this.itemTemplateId=this.options.itemTemplateId||this.inputElement.dataset.suggestItemTemplate,this.dropdownTemplateId){const e=document.getElementById(this.dropdownTemplateId);if(!e)throw new Error("Dropdown template not found");const t=document.importNode(e.content,!0);if(this.dropdownElement=t.querySelector(this.dropdownClass),!this.dropdownElement)throw new Error("Dropdown menu not found in dropdown template");if(this.inputElement.parentNode.insertBefore(this.dropdownElement,this.inputElement.nextSibling),this.itemTemplateId){const e=document.getElementById(this.itemTemplateId);if(!e)throw new Error("Item template not found");this.itemTemplateContent=e.content}}else this.dropdownElement=document.createElement("div"),this.dropdownElement.className=this.dropdownClass,this.inputElement.parentNode.insertBefore(this.dropdownElement,this.inputElement.nextSibling);this.dropdownElement.style.position="absolute",this.dropdownElement.style.left="auto",this.dropdownElement.style.top="auto",this.dropdownElement.style.display="none",this.populateDropdown(),this.inputElement.addEventListener("focus",this.onFocus),this.inputElement.addEventListener("blur",this.onBlur),this.inputElement.addEventListener("input",this.handleInput),this.inputElement.addEventListener("change",this.handleChange)}get menu(){return this.dropdownElement.querySelector(`.${this.dropdownClass}`)||this.dropdownElement}get menuItems(){return[...this.dropdownElement.querySelectorAll(`.${this.dropdownItemClass}`)]}populateDropdown(){if(this.dropdownElement){const e=this.menu;e.innerHTML="",this.data.forEach((t=>{if(this.itemTemplateContent){const n=document.importNode(this.itemTemplateContent,!0),i=n.querySelector(`.${this.dropdownItemClass}`);i&&(i.textContent=t,i.dataset.option=t,i.addEventListener("click",(()=>this.selectOption(t))),e.appendChild(n))}else{const n=document.createElement("a");n.className=this.dropdownItemClass,n.textContent=t,n.dataset.option=t,n.addEventListener("click",(()=>this.selectOption(t))),e.appendChild(n)}})),this.highlightSelectedOption()}}selectOption(e){this.selectedOption=e,this.inputElement.value=e,this.dropdownElement.style.display="none",this.onSelect&&this.onSelect(e),this.inputElement.dispatchEvent(new Event("input",{bubbles:!0})),this.inputElement.dispatchEvent(new Event("change",{bubbles:!0}))}highlightSelectedOption(){this.menuItems.forEach((e=>{e.dataset.option===this.selectedOption?e.classList.add(this.dropdownItemActiveClass):e.classList.remove("active")}))}handleChange(e){}handleInput(e){const t=e.target.value.toLowerCase().trim();this.menuItems.forEach((e=>{const n=e.dataset.option.toLowerCase().split(/\s+/),i=0===t.length||n.some((e=>e.includes(t)));e.style.display=i?"block":"none"})),this.highlightSelectedOption()}handleProgrammaticInput(e){this.onSelect&&this.onSelect(e.target.value)}onFocus(e){this.inputElement.select(),this.dropdownElement.style.display="block",this.menuItems.forEach((e=>{e.style.display="block"})),this.userInteraction=!0,e.stopImmediatePropagation()}onBlur(){setTimeout((()=>this.dropdownElement.style.display="none"),200),this.userInteraction=!1}dispose(){this.inputElement.removeEventListener("focus",this.onFocus),this.inputElement.removeEventListener("blur",this.onBlur),this.inputElement.removeEventListener("input",this.handleInput),this.dropdownElement&&this.dropdownElement.parentNode.removeChild(this.dropdownElement)}}const u=["Arial","Verdana","Helvetica","Times New Roman","Courier New","Georgia","Comic Sans MS","Trebuchet MS","Impact","Lucida Sans"],p=["Roboto","Open Sans","Lato","Montserrat","Oswald","Raleway","Roboto Condensed","Roboto Slab","Source Sans Pro","Poppins","Nunito","Merriweather","Playfair Display","Work Sans","Ubuntu","Dosis","Fira Sans","Cabin","Cabin Condensed"],f={},v=e=>{e.currentTarget.querySelectorAll('[data-type="font"]').forEach((e=>{const t=e.value?.trim();t&&p.includes(t)&&function(e){const t=function(e){const t=e.replace(/ /g,"+").replace(/[^\w+]/g,"");return`https://fonts.googleapis.com/css2?family=${t}:wght@400;700&display=swap`}(e);let n=document.querySelector(`link[href="${t}"]`);n||(n=document.createElement("link"),n.rel="stylesheet",n.href=t,document.head.appendChild(n))}(t)}))};const y=new Map;class E{constructor(e){this.form=e,this.stylesheetId=this.generateUniqueId(),this.initializeForm(),this.addEventListeners(),y.set(e,this),function(e){const t=[...e.querySelectorAll([a,o].join(", "))];t.filter((e=>e.hasAttribute("name"))).forEach((e=>{c(e)})),t.forEach((e=>{e.addEventListener("change",m),e.addEventListener("input",m)})),e.addEventListener("input",d),e.addEventListener("change",d)}(e),(e=>{e.querySelectorAll('[data-type="font"]').forEach((e=>{const t=new h(e,{data:u.concat(p)});f[e.id]=t})),e.addEventListener("change",v)})(e)}generateUniqueId(){return`dynamic-stylesheet-${Date.now()}-${Math.floor(1e4*Math.random())}`}sanitizePropertyValue(e){if(e.startsWith("#")&&4===e.length){const[,t,n,i]=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);e=`#${t}${t}${n}${n}${i}${i}`}return e}initializeForm(){this.initialValues=this.getInitialValues();for(const[e,t]of Object.entries(this.initialValues)){const n=this.form.elements[e];if(n&&n.tagName)if("select"===n.tagName.toLowerCase()){[...n.options].forEach((e=>{e.selected=e.value===t}))}else"radio"===n.type||"checkbox"===n.type?n.checked=n.value===t:n.value=t}const e=new FormData(this.form);this.updateAttributes(e),this.updateVisibility(),this.updateCodeSlot(this.updateStylesheet(e))}normalizeSelector(e){return e.replace(/"/g,"")}getInitialValues(){const e={},t=[...this.form.elements].filter((e=>e.name));for(const n of t){const t=n.name;let[i,s]=t.split("::property");if(!s)continue;const o=s.replace(/^\(|\)$/g,"").trim();i=i.replace(/^selector\(/,"").replace(/\)$/,"").trim(),i=this.normalizeSelector(i);const a=i.split(",").map((e=>e.trim()));[...document.styleSheets].forEach((n=>{[...n.cssRules].forEach((n=>{if(!n.selectorText)return;const i=n.selectorText.split(",").map((e=>this.normalizeSelector(e).trim()));if(0===a.filter((e=>i.includes(e))).length)return;const s=Object.fromEntries(n.cssText.split("{")[1].split("}")[0].trim().split(";").map((e=>e.trim())).filter((e=>e)).map((e=>[e.split(":")[0].trim(),e.split(":")[1].trim()])));if(s[o]){let n=s[o];n=this.sanitizePropertyValue(n),e[t]=n}}))}))}return e}updateStylesheet(e){let t="";const n={};e.forEach(((e,t)=>{const i=this.form.elements[t];if(!i)return;const s=!i.validity||i.validity.valid;if(t.includes("::property")){const[i,o]=t.split("::property"),a=i.replace(/^selector\(/,"").replace(/\)$/,"").trim(),r=o.replace(/^\(|\)$/g,"").trim();s&&this.initialValues[t]!==e&&(n[a]||(n[a]=[]),n[a].push(`${r}: ${e}`))}}));for(const[e,i]of Object.entries(n))t+=`${e} {\n`,t+=`    ${i.join(";\n    ")};\n`,t+="}\n";let i=document.getElementById(this.stylesheetId);return i||(i=document.createElement("style"),i.id=this.stylesheetId,document.body.appendChild(i)),i.textContent=t,t}updateAttributes(e){e.forEach(((e,t)=>{if(t.includes("::attribute")){const[n,i]=t.split("::attribute"),s=n.replace(/^selector\(/,"").replace(/\)$/,"").trim(),o=i.replace(/^\(|\)$/g,"").trim();document.querySelectorAll(s).forEach((t=>{t.getAttribute(o)!==e&&t.setAttribute(o,e)}))}}))}updateCodeSlot(e){const t=[...document.querySelectorAll("[data-theme-editor-code]")].filter((e=>this.form.matches(e.dataset.themeEditorCode))),n=[...document.querySelectorAll("[data-theme-editor-asset]")].map((e=>{if(e.getAttribute("data-theme-editor-asset")||!!e.textContent){const t=e.sheet?(e=>{let t="";for(let n of e.cssRules)t+=`${n.cssText}\n`;return t})(e.sheet):e.textContent;return t.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\s*([{}:;,])\s*/g,"$1").replace(/;}/g,"}").replace(/\s+/g," ").trim()}{const t=new URL(e.getAttribute("href"),document.baseURI).href;if(t)return`@import url('${t}');\n`}return""}));e=n.length&&e.trim()?"\n\n"+e:e,e=[...n,e].join("\n"),t.forEach((t=>{const n=t.tagName.toLowerCase();"pre"===n||"code"===n?t.textContent=e:"textarea"===n?t.value=e:t.innerHTML=e}))}handleFormChange(){const e=new FormData(this.form),t=this.updateStylesheet(e);this.updateAttributes(e),this.updateVisibility(),this.updateCodeSlot(t)}updateVisibility(){document.querySelectorAll("[data-hidden-if]").forEach((e=>{const t=e.getAttribute("data-hidden-if"),n=null===document.querySelector(t);e.hidden=n}))}addEventListeners(){this.handleFormInput=()=>this.handleFormChange(),this.form.addEventListener("input",this.handleFormInput),this.form.addEventListener("change",this.handleFormInput),this.copyButton=document.querySelector("[data-copy]"),this.copyButton&&(this.handleCopyButtonClick=()=>{const e=document.querySelector("[data-output]");e&&(e.select(),document.execCommand("copy"),alert("Stylesheet copied to clipboard!"))},this.copyButton.addEventListener("click",this.handleCopyButtonClick))}removeEventListeners(){this.form&&(this.form.removeEventListener("input",this.handleFormInput),this.form.removeEventListener("change",this.handleFormInput)),this.copyButton&&this.copyButton.removeEventListener("click",this.handleCopyButtonClick)}dispose(){disposeSyncForms(this.form),this.form.querySelectorAll('[data-type="font"]').forEach((e=>{e.removeEventListener("change",handleFontChange),f[e.id].dispose(),delete f[e.id]})),this.removeEventListeners();const e=document.getElementById(this.stylesheetId);e&&e.remove(),y.delete(this.form),this.form=null,this.copyButton=null,this.stylesheetId=null}}document.addEventListener("DOMContentLoaded",(()=>{var e,t,n;document.querySelectorAll("form[data-theme-editor]").forEach((e=>{new E(e)})),e="form[data-theme-editor]",t=e=>{new E(e)},n=e=>{const t=y.get(e);t&&t.dispose()},new MutationObserver((i=>{i.forEach((i=>{i.addedNodes.length&&i.addedNodes.forEach((n=>{n.matches&&n.matches(e)&&t(n)})),i.removedNodes.length&&i.removedNodes.forEach((t=>{t.matches&&t.matches(e)&&n(t)}))}))})).observe(document,{childList:!0,subtree:!0})}))}();
